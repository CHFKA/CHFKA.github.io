## 概述

- 理解传输层的工作原理

  - 多路复用/解复用
  - 可靠数据传输
  - 流量控制
  - 拥塞控制
- 学习Internet的传输层协议

  - UDP：无连接传输
  - TCP：面向连接的可靠传输
  - TCP的拥塞控制

<!-- more -->

## 传输层服务

- 为运行在不同主机上的应用进程提供逻辑通信
- 传输协议运行在端系统
  - 发送方：将应用层的报文分成报文段，然后传递给网络层
  - 接收方：将报文段重组成报文，然后传递给应用层
- 有多个传输层协议可供应选择：TCP和UDP
- 进程间的逻辑通信
  - 依赖于网络层的服务--带宽、延时
  - 并对网络层的服务进行增强
    - 数据丢失、顺序混乱、加密
- 协议
  - TCP
    - 多路复用、解复用
    - 拥塞控制
    - 流量控制
    - 建立连接
  - UDP
    - 多路复用、解复用
    - 没有尽力而为的为IP服务添加更多的其他额外服务
  - 都不提供的服务
    - 延时保证
    - 带宽保证

## 多路复用与解复用

复用：多个应用层协议使用一个传输层传递数据
解复用：一个传输层把不同的数据正确交付给不同应用

- 发送方多路复用
  从多个套接字接收来自多个进程的报文，根据套接字对应的IP地址和端口号等信息对报文段用头部加以封装(该头部信息用于以后的解复用)
- 接收方多路解复用
  根据报文段的头部信息中的IP地址和端口号将接受到的报文段给正确的套接字(和对应的应用进程)
- UDP的多路复用与解复用
  - 用二元组标示(目标IP、目标端口号)
  - 如果两个不同源IP地址/源端口号，但是有**相同的目标IP地址和端口号**，则被定位相同的套接字
- TCP的多路复用与解复用
  - 四元组标示：源IP地址、源端口号、目的IP地址、目的端口号
  - Web服务器对每个连接客户端有不同的套接字
    - 非持久对每个请求有不同的套接字
    - 多线程Web服务器：
      1. 一个进程下下面可能多个线程：由多个线程分别为客户提供服务
      2. 根据4元组决定将报文段内容发到同一个进程下不同的线程
      3. 解复用到不同的线程

## UDP

UDP:User Datagram Protocol

- “尽力而为”的服务，报文段可能丢失、送到应用进程的报文段乱序
- 无连接：
  - 没有握手
  - 每个UDP报文段都被独立的处理
- 使用
  - 流媒体
  - DNS
  - SNMP
- 在UDP上实现可靠传输
  - 在应用层增加可靠性
  - 应用特定的差错恢复
- 用户数据报协议

  <tbale>
    <tr>
      <td>源端口号</td>
      <td>目的端口号</td>
    </tr>
    <tr>
      <td>长度</td>
      <td>校验和</td>
    </tr>
    <tr>
      <td colspan="2">应用程序数据(报文)</td>
    </tr>
  </table>

- UDP的必要性
  - 不建立连接
  - 简单：没有连接的状态
  - 报文段的头部很小(开销小)
  - 无拥塞控制和流量控制
    UDP可以尽可能快的发送报文段
    应用->传输速率 = 主机 -> 网络的速率

- UDP校验和
  - 目标：检测在被传输报文中的差错(如比特反转)
  - 发送方：
    - 将报文段的内容视为16比特的整数
    - 校验和：报文段的加法和(1的补运算)
    - 发送方将校验和放在UDP的校验和字段
  - 接收方
    - 计算接收到的报文段的校验和
    - 检查计算出的校验和与校验和字段的内容是否相等
      - 不相等--检测到差错
      - 相等--可能有差错：残存错误
- 校验和
  - 当数字相加时，在最高位的进位要回卷，再加到结果上
  - 目标端：校验范围+校验和 = 1111 1111 1111 1111 通过校验
  - 求和时，必须将进位回卷到结果上

## 可靠数据传输的原理

## TCP

### 段结构

### 可靠数据传输

### 流量控制

## 拥塞控制原理

## TCP拥塞控制
