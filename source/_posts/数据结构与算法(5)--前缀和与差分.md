---
title: 前缀和与差分
date: 2021-07-31 16:37:53
tags: 算法

---

# 介绍  

​	

<!-- more -->  

# 前缀和与差分

前缀和与差分是一对逆运算。

## 前缀和

### 一维前缀和

有一列整数序列:$\mathbf{a}_1,\mathbf{a}_2,\mathbf{a}_3.....,\mathbf{a}_n$,其前缀和:$\mathbf{S}_n = \mathbf{a}_1+\mathbf{a}_2+\mathbf{a}_3+....+\mathbf{a}_n$.

作用：求上述序列中[l,r]的和，使用数组相加的时间复杂度为O(n),使用前缀和的时间复杂度为O(1).
$$
\mathbf{S}_{r-l} = \mathbf{S}_r - \mathbf{S}_{l-1}
$$
实现：

```c++
#include<iostream>

using namespace std;

const N = 100010;

int n,m;
int a[N],s[N];
int main()
{
    scanf("%d%d",&n,&m);
    for(int i = 1; i < n; i++) scanf("%d",&a[i]);
    for(int i = 1; i < n; i++) s[i] = s[i - 1] + a[i];
    while(m--)
    {
        int l,r;
        scanf("%d%d",&l,&r);
        printf("%d\n",s[r]-s[l-1]);
    }
    return 0;
}
```



### 二维前缀和

![前缀和与差分](Prefix_sum_and_difference.png)

计算二维前缀和：$\mathbf{S}_{[i,j]} =\mathbf{a}_{[1,1]}+\mathbf{a}_{[1,2]} +\mathbf{a}_{[1,j]}+\mathbf{a}_{[2,1]}+\mathbf{a}_{[2,2]}+....+\mathbf{a}_{[i,j]}$ 

即：$\mathbf{S}_{[\mathbf{i},\mathbf{j}]} = \mathbf{S}_{[\mathbf{i}-1，\mathbf{j}]}+\mathbf{S}_{[\mathbf{i}-1，\mathbf{j}]}-\mathbf{S}_{[\mathbf{i}-1，\mathbf{j}-1]}+\mathbf{a}_{[\mathbf{i}，\mathbf{j}]}$

已知(x1,y1),(x2,y2)求得这一子矩阵的和$\mathbf{S}=\mathbf{S}_{[\mathbf{x}_2,\mathbf{y}_2]} - \mathbf{S}_{[\mathbf{x}_1-1,\mathbf{y}_2]}-\mathbf{S}_{[\mathbf{x}_2,\mathbf{y}_1-1]}+\mathbf{S}_{[\mathbf{x}_1-1,\mathbf{y}_1-1]}$


实现：

```c++
#include<iostream>
using namespace std;
const int N = 1010;
int n,m,q;
int a[N][N],s[N][N];
int main()
{
    scanf("%d%d%d",&n,&m,&q);
    for(int i = 1; i <= n; i++)
        for(int j = 1; i <= m; i++)
            scanf("%d",&a[i][j]);
    //初始化前缀和数组
    for(int i = 1; i <= n; i++)
        for(int j = 1; j <= m; j++)
            s[i][j] = s[i-1][j] + s[i][j-1]- s[i-1][j-1] + a[i][j];
    while(q--)
    {
        int x1,x2,y1,y2;
        scanf("%d%d%d%d",&x1,&y1,&x2,&y2);
        printf("%d",s[x2][y2] - s[x2][y1-1] - s[x1-1][y2] + s[x1-1][y-1]);
    }
}
```

## 差分

### 一维差分

有一列整数序列:$\mathbf{a}_1,\mathbf{a}_2,\mathbf{a}_3,...,\mathbf{a}_n$
构造：$\mathbf{b}_1,\mathbf{b}_2,\mathbf{b}_3,...,\mathbf{b}_n$
使得：$\mathbf{a}=\mathbf{b}_1+\mathbf{b}_2+\mathbf{b}_3+...+\mathbf{b}_n$
即:   $\mathbf{b}_1 = \mathbf{a}_1$

​        $\mathbf{b}_2 = \mathbf{a}_2 - \mathbf{a}_1$

​		$...$

​		$\mathbf{b}_n = \mathbf{a}_n - \mathbf{a}_{n-1}$

实现：

```c++
#include<iostream>
using namespace std;
const int N =100010;

int n,m;
int a[N], b[N];
void insert(int l, int r,int c)
{
    b[l] += c;
    b[r + 1] -= c;
}
int main()
{
    scanf("%d%d",&n,&m);
    for(int i = 1; i <= n; i++) scanf("%d",&a[i]);
    for(int i = 1; i <= n; i++) insert(i,i,a[i]);
    while(m--)
    {
        int l,r,c;
        scanf("%d%d%d",&l,&r,&c);
        insert(l,r,c);
    }
    for(int i = 1; i <= n; i++) b[i] += b[i-1];//将b数组转换为其前缀和
    for(int i = 1; i <= n; i++) printf("%d",b[i]);
    return 0;
}
```



### 二维差分

![前缀和与差分](前缀和与差分.png)

给定原矩阵a[i,j],构造差分矩阵b[i,j],使得a[i,j] 是b[i,j]的前缀和

差分核心操作：给以(x1,y1)为左上角,(x2,y2)为右下角的子矩阵中的所有数a[i,j],加上c。

对于差分数组的影响:

​																				$\mathbf{b}_{[\mathbf{x}_1,\mathbf{y}_1]} \,+= \,C$

​																				$\mathbf{b}_{[\mathbf{x}_1,\mathbf{y}_2+1]} \,-= \,C$

​																				$\mathbf{b}_{[\mathbf{x}_1+1,\mathbf{y}_2]} \,-= \,C$

​																				$\mathbf{b}_{[\mathbf{x}_2+1,\mathbf{y}_2+1]} \,+= \,C$

实现：

```c++
#include<iostream>
using namespace std;

const int N =1010;
int n, m. q;
int a[N][N],b[N][N];

void insert(int x1, int y1,int x2,int y2,int c)
{
    b[x1][y1] += c;
    b[x1][y2+1] -= c;
    b[x2+1][y1] -= c;
    b[x2+1][y2+1] += c;
}
int main()
{
    scanf("%d%d%d",&n,&m,&q);
    for(int i = 1; i <= n; i++)
        for(int j = 1; j <= m; j++)
            scanf("%d",&a[i][j]);
	for(int i = 1; i <= n; i++)
        for(int j = 1; j <= m; j++)
            insert(i,j,i,j,a[i][j]);
    while(q--)
    {
        int x1,y1,x2,y2;
        scanf("%d%d%d%d",&x1,&y1,&x2,&y2);
        insert(x1,y1,x2,y2);
    }
    for(int i = 1; i <= n; i++)
        for(int j =1; j <= m; j++)
            a[i][j] = a[i-1][j] + a[i][j-1] -a[a-1][j-1] + b[i][j];
    for(int i = 1; i <= n; i++)
    {
        for(int j = 1; j <= m; j++) printf("%d ",a[i][j]);
        puts("");
    }
    return 0;
            
}
```

